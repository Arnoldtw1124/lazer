{% extends 'base.html' %}

{% block title %}ç®¡ç†æ§åˆ¶å° - è«¾é›• ALE{% endblock %}

{% block content %}
<section style="min-height: 100vh; background: #0f0f13; padding: 100px 5%;">

    <div style="
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 3rem;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 1rem;
    ">
        <h1 style="color: white; font-family: 'Orbitron', sans-serif; letter-spacing: 2px;">
            COMMAND CENTRE <span style="font-size: 1rem; color: var(--secondary-color);">// ADMIN V2</span>
        </h1>
        <a href="{{ url_for('admin_logout') }}" style="
            color: #ff4d4d; 
            text-decoration: none; 
            border: 1px solid #ff4d4d; 
            padding: 0.5rem 1rem; 
            border-radius: 5px;
            transition: all 0.3s;
        " onmouseover="this.style.background='#ff4d4d'; this.style.color='white'"
            onmouseout="this.style.background='transparent'; this.style.color='#ff4d4d'">
            LOGOUT
        </a>
    </div>

    <!-- Orders Table -->
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; color: rgba(255,255,255,0.9);">
            <thead>
                <tr style="border-bottom: 2px solid var(--secondary-color); text-align: left;">
                    <th style="padding: 1rem; color: var(--secondary-color);">ID</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">æ—¥æœŸ</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">å§“å</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">ç”¢å“/æè³ª</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">åœ–ç‰‡</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">ç‹€æ…‹</th>
                    <th style="padding: 1rem; color: var(--secondary-color);">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.3s;"
                    onmouseover="this.style.background='rgba(255,255,255,0.02)'"
                    onmouseout="this.style.background='transparent'">

                    <td style="padding: 1rem; font-family: monospace;">#{{ order.id }}</td>
                    <td style="padding: 1rem; font-size: 0.9rem; color: #888;">{{ order.date.strftime('%Y-%m-%d %H:%M')
                        }}</td>
                    <td style="padding: 1rem; font-weight: bold;">{{ order.name }}<br><span
                            style="font-size:0.8rem; color:#666;">{{ order.contact }}</span></td>
                    <td style="padding: 1rem;">
                        <span style="
                            background: rgba(0, 255, 255, 0.1); 
                            color: var(--secondary-color); 
                            padding: 0.2rem 0.5rem; 
                            border-radius: 3px; 
                            font-size: 0.8rem;
                        ">{{ order.material }}</span>
                    </td>
                    <td style="padding: 1rem;">
                        {% if order.filename %}
                        <a href="{{ url_for('static', filename='uploads/' + order.filename) }}" target="_blank">
                            <img src="{{ url_for('static', filename='uploads/' + order.filename) }}" alt="Upload"
                                style="width: 50px; height: 50px; object-fit: cover; border: 1px solid #555; border-radius: 4px; transition: transform 0.2s;"
                                onmouseover="this.style.transform='scale(2)'"
                                onmouseout="this.style.transform='scale(1)'">
                        </a>
                        {% else %}
                        <span style="color: #444; font-size: 0.8rem;">ç„¡åœ–ç‰‡</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem;">
                        <!-- Status Update Form -->
                        <form action="{{ url_for('update_status', order_id=order.id) }}" method="POST">
                            <select name="status" onchange="this.form.submit()" style="
                                background: #1a1a1f; 
                                color: {{ '#ff9f43' if order.status == 'Pending' else '#00d2d3' if order.status == 'Processing' else '#2ecc71' if order.status == 'Completed' else '#ff6b6b' }};
                                border: 1px solid #333; 
                                padding: 0.3rem; 
                                border-radius: 4px;
                                font-size: 0.9rem;
                                outline: none;
                            ">
                                <option value="Pending" {% if order.status=='Pending' %}selected{% endif %}>ğŸŸ  å¾…ç¢ºèª
                                </option>
                                <option value="Processing" {% if order.status=='Processing' %}selected{% endif %}>ğŸ”µ è£½ä½œä¸­
                                </option>
                                <option value="Completed" {% if order.status=='Completed' %}selected{% endif %}>ğŸŸ¢ å·²å®Œæˆ
                                </option>
                                <option value="Cancelled" {% if order.status=='Cancelled' %}selected{% endif %}>ğŸ”´ å·²å–æ¶ˆ
                                </option>
                            </select>
                        </form>
                    </td>
                    <td style="padding: 1rem;">
                        <!-- Delete Form -->
                        <form action="{{ url_for('delete_order', order_id=order.id) }}" method="POST"
                            style="display: inline;" onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤è¨‚å–® #{{ order.id }} å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼');">
                            <button type="submit" style="
                                background: transparent; 
                                border: 1px solid #ff4757; 
                                color: #ff4757; 
                                width: 30px; 
                                height: 30px; 
                                border-radius: 5px; 
                                cursor: pointer;
                                display: flex; align-items: center; justify-content: center;
                            " title="åˆªé™¤è¨‚å–®">
                                ğŸ—‘ï¸
                            </button>
                        </form>
                    </td>
                </tr>
                <!-- Expandable Row for Notes -->
                {% if order.notes %}
                <tr style="background: rgba(0,0,0,0.2); border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <td colspan="7" style="padding: 0.5rem 1rem; padding-left: 2rem; font-size: 0.85rem; color: #aaa;">
                        <strong>ğŸ“ å‚™è¨»ï¼š</strong> {{ order.notes }}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

</section>
{% endblock %}