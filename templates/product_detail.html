{% extends 'base.html' %}

{% block title %}{{ product.name }} - 諾雕 ALE{% endblock %}

{% block content %}
<section style="padding: 120px 10%; min-height: 80vh; display: flex; justify-content: center; align-items: flex-start;">

    <div class="product-detail-card" style="
        background: var(--card-bg); 
        border-radius: 20px; 
        border: var(--glass-border); 
        padding: 3rem; 
        width: 100%; 
        max-width: 900px;
        display: flex;
        flex-wrap: wrap;
        gap: 3rem;
        backdrop-filter: blur(10px);
    ">
        <!-- 模擬圖片區域 (因無真實圖片，用色塊代替) -->
        <div
            style="flex: 1; min-width: 300px; height: 300px; overflow: hidden; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2);">
            <img src="{{ url_for('static', filename='images/' + product.image) }}" alt="{{ product.name }}"
                class="img-display"
                style="width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s ease;">
        </div>

        <div style="flex: 1; min-width: 300px;">
            <h2 style="font-size: 2.5rem; margin-bottom: 0.5rem; color: var(--primary-color);">{{ product.name }}</h2>
            <div style="font-size: 2rem; font-weight: 700; color: var(--secondary-color); margin-bottom: 1.5rem;">
                {{ product.price }}
            </div>

            <p style="margin-bottom: 2rem; line-height: 1.8; color: rgba(255,255,255,0.9);">
                {{ product.desc }}
            </p>

            {% if product.variants %}
            <div style="margin-bottom: 2rem;">
                <h4 style="margin-bottom: 1rem; color: var(--text-color);">選擇款式 (Select Style)：</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    {% for variant in product.variants %}
                    <button class="variant-btn"
                        onclick="changeVariant(this, '{{ variant.image }}', '{{ variant.name }}')" style="
                            padding: 0.5rem 1.5rem; 
                            border: 1px solid var(--secondary-color); 
                            background: rgba(0,0,0,0.3); 
                            color: white; 
                            border-radius: 5px; 
                            cursor: pointer;
                            transition: all 0.3s;
                            font-family: inherit;
                        ">
                        {{ variant.name }}
                    </button>
                    {% endfor %}
                    <button class="variant-btn" onclick="resetVariant(this)" id="reset-btn" style="
                            padding: 0.5rem 1.5rem; 
                            border: 1px solid #666; 
                            background: rgba(0,0,0,0.3); 
                            color: #aaa; 
                            border-radius: 5px; 
                            cursor: pointer;
                            transition: all 0.3s;
                            font-family: inherit;
                            display: none;
                        ">
                        重置 (Reset)
                    </button>
                </div>
            </div>
            {% endif %}

            <div style="margin-bottom: 2rem; background: rgba(0,0,0,0.2); padding: 1.5rem; border-radius: 10px;">
                <h4 style="margin-bottom: 1rem; color: var(--text-color);">產品規格：</h4>
                <ul style="list-style: none; padding-left: 0;">
                    {% for spec in product.specs %}
                    <li
                        style="margin-bottom: 0.5rem; color: rgba(255,255,255,0.7); display: flex; align-items: center;">
                        <span
                            style="display: inline-block; width: 6px; height: 6px; background: var(--secondary-color); border-radius: 50%; margin-right: 10px;"></span>
                        {{ spec }}
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <script>
                const defaultImage = "{{ url_for('static', filename='images/' + product.image) }}";

                function changeVariant(btn, imageName, variantName) {
                    // Update Image
                    const imgElement = document.querySelector('.img-display');
                    imgElement.src = "{{ url_for('static', filename='images/') }}" + imageName;
                    imgElement.style.opacity = 0;
                    setTimeout(() => imgElement.style.opacity = 1, 50);

                    // Update UI Buttons
                    document.querySelectorAll('.variant-btn').forEach(b => {
                        b.style.background = 'rgba(0,0,0,0.3)';
                        b.style.color = 'white';
                        b.style.borderColor = 'var(--secondary-color)';
                    });

                    // Highlight selected
                    btn.style.background = 'var(--secondary-color)';
                    btn.style.color = 'black';
                    btn.style.boxShadow = '0 0 10px var(--secondary-color)';

                    // Show Reset Button
                    document.getElementById('reset-btn').style.display = 'block';
                }

                function resetVariant(btn) {
                    // Reset Image
                    const imgElement = document.querySelector('.img-display');
                    imgElement.src = defaultImage;

                    // Reset Buttons
                    document.querySelectorAll('.variant-btn').forEach(b => {
                        if (b.id !== 'reset-btn') {
                            b.style.background = 'rgba(0,0,0,0.3)';
                            b.style.color = 'white';
                            b.style.boxShadow = 'none';
                        }
                    });

                    // Hide Reset Button
                    btn.style.display = 'none';
                }
            </script>

            <a href="{{ url_for('booking') }}?product={{ product.name }}" class="btn btn-primary"
                style="width: 100%; text-align: center;">立即預約此產品</a>

            <div style="text-align: center; margin-top: 1rem;">
                <a href="{{ url_for('guidelines') }}"
                    style="font-size: 0.9rem; color: var(--secondary-color); text-decoration: underline;">
                    ⚠ 送印檔案規範 (File Guidelines)
                </a>
            </div>
            <a href="{{ url_for('products') }}"
                style="display: block; text-align: center; margin-top: 1rem; color: rgba(255,255,255,0.5); text-decoration: none;">←
                返回產品列表</a>
        </div>
    </div>

</section>
{% endblock %}